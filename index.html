<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GPS Overlay (Multi Images Live Update)</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; text-align: center; }
    input, button { margin: 5px; padding: 8px; font-size: 14px; }
    .preview-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 20px; }
    .capture { width: 400px; position: relative; background: white; overflow: hidden; border: 1px solid #ccc; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    .main-photo { width: 400px; height: 500px; object-fit: fill; display: block; background-color: white; }
    .gps-footer { position: absolute; bottom: 10px; left: 0; width: 400px; background-color: rgba(44, 44, 44, 0.85); color: white; display: flex; align-items: flex-start; padding: 8px; font-size: 11px; box-sizing: border-box; }
    .map-thumbnail { width: 50px; height: 50px; object-fit: cover; margin-right: 8px; }
    .gps-details { flex-grow: 1; line-height: 1.3; text-align: left; }
    .gps-details b { font-family: Georgia, serif; font-size: 13px; display: block; margin-bottom: 4px; }
    .gps-logo { display: flex; align-items: center; font-size: 10px; font-family: Arial, sans-serif; margin-left: 6px; margin-top: 4px; }
    .gps-logo-icon { width: 14px; height: 14px; margin-right: 4px; }
    .download-btn { margin-top: 15px; background-color: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; padding: 8px 16px; font-size: 14px; }
    .download-btn:hover { background-color: #0056b3; }
  </style>
</head>
<body>

<h2>GPS Image Overlay Generator (Multiple, Live Update)</h2>

<div class="form-container">
  <input type="file" id="imageUpload" accept="image/*" multiple />
  <br />
  <input type="text" id="city" placeholder="City (e.g. Ārifwāla)" />
  <input type="text" id="address" placeholder="Address" />
  <br />
  <input type="text" id="latitude" placeholder="Latitude (e.g. 30.297293)" />
  <input type="text" id="longitude" placeholder="Longitude (e.g. 73.066914)" />
  <br />
  <input type="text" id="date" placeholder="DD/MM/YYYY" maxlength="10" />
</div>

<button class="download-btn" onclick="downloadAll()">Download All (ZIP)</button>

<div class="preview-container" id="previewContainer"></div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script>
  let imagesData = [];

  document.getElementById("imageUpload").addEventListener("change", handleFiles);

  function handleFiles(event) {
    const files = event.target.files;
    if (!files.length) return;
    imagesData = [];
    document.getElementById("previewContainer").innerHTML = "";

    Array.from(files).forEach((file) => {
      const reader = new FileReader();
      reader.onload = function(e) {
        const container = document.createElement("div");
        container.className = "capture";
        container.innerHTML = `
          <img src="${e.target.result}" class="main-photo" />
          <div class="gps-footer">
            <img src="data/icon.png" alt="Map" class="map-thumbnail" />
            <div class="gps-details">
              <b class="gps-location"></b>
              <span class="gps-address"></span><br />
              Lat <span class="gps-lat"></span>° Long <span class="gps-lng"></span>°<br />
              <span class="gps-datetime"></span>
            </div>
            <div class="gps-logo">
              <img src="data/icon2.png" alt="GPS Icon" class="gps-logo-icon" />
              <span>GPS Malaya</span>
            </div>
          </div>
        `;
        document.getElementById("previewContainer").appendChild(container);
        imagesData.push(container);
        updateOverlay(); // live update after load
      };
      reader.readAsDataURL(file);
    });
  }

  function randomizeCoord(coord) {
    let [intPart, decPart] = coord.split(".");
    if (!decPart) decPart = "000000";
    let fixed = decPart.slice(0, decPart.length - 3);
    let rand = Math.floor(Math.random() * 900 + 100);
    return intPart + "." + fixed + rand;
  }

  function randomizeTime() {
    let hour = Math.floor(Math.random() * 12) + 1;
    let minute = Math.floor(Math.random() * 60);
    let ampm = Math.random() > 0.5 ? "AM" : "PM";
    return `${String(hour).padStart(2,"0")}:${String(minute).padStart(2,"0")} ${ampm}`;
  }

  function updateOverlay() {
    const city = document.getElementById('city').value.trim() || 'Ārifwāla';
    const address = document.getElementById('address').value.trim() || 'M Block';
    const baseLat = document.getElementById('latitude').value.trim() || '30.297293';
    const baseLng = document.getElementById('longitude').value.trim() || '73.066914';
    const date = document.getElementById('date').value.trim() || '11/08/2025';

    imagesData.forEach(container => {
      // regenerate fresh coords + time every update
      let lat = randomizeCoord(baseLat);
      let lng = randomizeCoord(baseLng);
      let timeStr = randomizeTime();

      container.querySelector(".gps-location").innerText = `${city}, Punjab, Pakistan`;
      container.querySelector(".gps-address").innerText = `${address}, ${city}, Punjab, Pakistan`;
      container.querySelector(".gps-lat").innerText = lat;
      container.querySelector(".gps-lng").innerText = lng;
      container.querySelector(".gps-datetime").innerText = `${date} ${timeStr} GMT +05:00`;
    });
  }

  const fields = ['city', 'address', 'latitude', 'longitude', 'date'];
  fields.forEach(id => {
    document.getElementById(id).addEventListener('input', updateOverlay);
    document.getElementById(id).addEventListener('change', updateOverlay);
  });

  function downloadAll() {
    let zip = new JSZip();
    let count = 0;
    imagesData.forEach((captureDiv, i) => {
      html2canvas(captureDiv, { useCORS: true, scale: 2 }).then((canvas) => {
        canvas.toBlob((blob) => {
          zip.file("gps-image-" + (i+1) + ".png", blob);
          count++;
          if (count === imagesData.length) {
            zip.generateAsync({ type: "blob" }).then((content) => {
              saveAs(content, "gps-images.zip");
            });
          }
        });
      });
    });
  }
</script>
</body>
</html>
